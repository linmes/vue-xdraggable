{"version":3,"file":"vue-xdraggable.js","sources":["../src/util/Observer.js","../src/util/Observable.js","../src/xdraggable.vue","../src/install.js","../src/index.js"],"sourcesContent":["var Observer = function(consumer){\n    this._consumer = consumer;\n};\nObserver.prototype.onNotify = function(data){\n    this._consumer.call(this,data);\n};\nexport default Observer;","var Observable = function(generator){\n    this._generator = generator;\n};\nObservable.prototype.subscribe = function(observer){\n    this._generator.call(this,observer);\n};\nexport default Observable;","<template>\n    <div>\n        <slot ref=\"drag\"></slot>\n    </div>\n</template>\n<script>\nimport Observer from './util/Observer.js';\nimport Observable from './util/Observable.js';\n//利用观察者模式和闭包的特性使事件只绑定一次，从而优化性能\nvar mouseup = new Observable((function(){\n    var observers = [] ;\n    document.addEventListener('mouseup',(e)=>{\n        observers.forEach((observer)=>{\n            observer.onNotify(e);\n        });\n    });\n    return function(observer){\n        observers.push(observer);\n    };\n})());\nvar mousemove = new Observable((function(){\n    var observers = [] ;\n    document.addEventListener('mousemove',(e)=>{\n        observers.forEach((observer)=>{\n            observer.onNotify(e);\n        });\n    });\n    return function(observer){\n        observers.push(observer);\n    };\n})());\nexport default {\n    props: {\n        move: {\n            type: String,\n            default: 'both'\n        },\n        randomPosition: {\n            type: Boolean,\n            default: false\n        }\n    },\n    data() {\n        return {\n            left: null,\n            top:  null,\n            //元素到鼠标的距离\n            pos:{\n                x:null,\n                y:null\n            },\n            //桌子的宽高\n            desk:{\n                width:null,\n                height:null\n            },\n            //移动物体的宽高\n            animal:{\n                width:null,\n                height:null\n            },\n            status: {\n                dragging :false\n            }\n        };\n    },\n    watch: {\n        left(val) {\n            this.$el.style.left = val+'px';\n        },\n        top(val) {\n            this.$el.style.top = val+'px';\n        }\n    },\n    mounted() {\n        //初始化桌子的宽高\n        this.desk.width = this.$el.parentNode.clientWidth;\n        this.desk.height = this.$el.parentNode.clientHeight;\n        //初始化移动物的宽高\n        this.animal.width = this.$el.clientWidth;\n        this.animal.height = this.$el.clientHeight;\n        var handle = this.$el.querySelector('[handle]')?this.$el.querySelector('[handle]'):this.$el;\n        //初始化随机位置\n        if(this.randomPosition){\n            this.$el.style.left = Math.floor(Math.random()*(this.desk.width - this.animal.width))+'px';\n            this.$el.style.top = Math.floor(Math.random()*(this.desk.height - this.animal.height))+'px';\n        }\n        this.left = this.$el.offsetLeft;\n        this.top = this.$el.offsetTop;\n        handle.addEventListener('mousedown',(e)=>{\n            this.$emit('dragstart',e);\n            this.status.dragging = true;\n            this.pos.x = e.clientX - this.left;\n            this.pos.y = e.clientY - this.top;\n        });\n        mousemove.subscribe(new Observer((e)=>{\n            e.preventDefault();\n            if(this.status.dragging==true){\n                this.$emit('dragging',e);\n                if(this.move == 'x' || this.move == 'both'){\n                    var left = (e.clientX-this.pos.x)>0?(e.clientX-this.pos.x):0;\n                    if(left>(this.desk.width-this.animal.width)){\n                        left = this.desk.width-this.animal.width;\n                    }\n                    this.left = left;\n                }\n                if(this.move == 'y' || this.move == 'both'){\n                    var top = (e.clientY-this.pos.y)>0?(e.clientY-this.pos.y):0;\n                    if(top>(this.desk.height-this.animal.height)){\n                        top = this.desk.height-this.animal.height;\n                    }\n                    this.top = top;\n                }\n            }\n        }));\n        mouseup.subscribe(new Observer((e)=>{\n            if(this.status.dragging==true){\n                this.$emit('dragend',e);\n            }\n            this.status.dragging = false;\n        }));\n    }\n};\n</script>\n<style>\n\n</style>\n\n","import Xdraggable from './xdraggable.vue';\nvar state = false;\n\nexport default function (Vue) {\n    if (state) return;\n    state = true;\n    Vue.component('xdraggable', Xdraggable);\n}","import install from './install';\r\n\r\nif (typeof window !== 'undefined' && window.Vue) {\r\n    install(window.Vue);\r\n}\r\n\r\nexport default install;"],"names":["Observer","consumer","_consumer","prototype","onNotify","data","call","Observable","generator","_generator","subscribe","observer","mouseup","observers","addEventListener","e","forEach","push","mousemove","String","Boolean","val","$el","style","left","top","desk","width","parentNode","clientWidth","height","clientHeight","animal","handle","querySelector","randomPosition","Math","floor","random","offsetLeft","offsetTop","$emit","status","dragging","pos","x","clientX","y","clientY","preventDefault","move","state","Vue","component","Xdraggable","window"],"mappings":"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"}